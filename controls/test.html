<!DOCTYPE html>
<html>

<head>
    <title>test</title>
    <style>
        .moveable {
            position: absolute;
            left: 200px;
            top: 200px;
            width: 500px;
            height: 400px;
            border: 1px solid red;
            display: flex;
        }

        .frame {
            border: none;
            flex: 1;
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0;
        }

        .sub {
            position: absolute;
            left: 0;
            top: 0;
            right: 0;
            cursor: pointer;
            user-select: none;
            z-index: 1;
        }
    </style>
</head>

<body>
    <button onclick="showWindow();">Show</button>
</body>
<script>
    function showWindow() {
        var div = document.createElement("div");
        div.className = "moveable";
        var frame = document.createElement("iframe");
        frame.className = "frame";
        document.body.appendChild(div);
        div.appendChild(frame);
        frame.src = "test2.html";
    }
    function mouseDown(e) {
        var context = { _startDragOff: {} };
        context._startDragOff.x = e.pageX;
        context._startDragOff.y = e.pageY;
        context._isPressed = true;
        context.win = this;
        var div = document.createElement("div");
        div.id = "noFrameEvents";
        div.style.position = "absolute";
        div.style.left = "0";
        div.style.top = "0";
        div.style.right = "0";
        div.style.bottom = "0";
        this.frame.contentDocument.body.appendChild(div);
        context.noFrameEvents = div;
        window.top.dragWindow = context;
        div.addEventListener("mouseup", mouseUp);
        div.addEventListener("mousemove", mouseMove);
        window.top.document.addEventListener("mousemove", mouseMove, false);
        window.top.document.addEventListener("mouseup", mouseUp, false);
    };
    function mouseUp(e) {
        window.top.document.removeEventListener("mousemove", mouseMove, false);
        window.top.document.removeEventListener("mouseup", mouseUp, false);
        window.top.dragWindow._isPressed = false;
        window.top.dragWindow.noFrameEvents.parentNode.removeChild(window.top.dragWindow.noFrameEvents);
        window.top.dragWindow = null;
    };
    function mouseMove(e) {
        var win = window.top.dragWindow, decOff = { x: 0, y: 0 }, p = { x: 0, y: 0 };
        decOff.x = Math.abs(win._startDragOff.x - p.x);
        decOff.y = Math.abs(win._startDragOff.y - p.y);
        p.x = e.pageX;
        p.y = e.pageY;
        if ((decOff.x !== 0 || decOff.y !== 0) && win._isPressed) {
            if (p.x < 0) p.x = 0;
            if (p.y < 0) p.y = 0;
            if (p.x > window.top.innerWidth) p.x = window.top.innerWidth;
            if (p.y > window.top.innerHeight) p.y = window.top.innerHeight;
            var newLeft = (win.win.parentNode.offsetLeft + (p.x - win._startDragOff.x)), newTop = (win.win.parentNode.offsetTop + (p.y - win._startDragOff.y));
            win.win.parentNode.style.left = newLeft + "px";
            win.win.parentNode.style.top = newTop + "px";
            win._startDragOff.x = p.x;
            win._startDragOff.y = p.y;
        }
        console.log(e);
    };
    document.addEventListener("DOMContentLoaded", function (event) {
        var callback = function (mutationsList) {
            for (var mutation of mutationsList) {
                if (mutation.type === 'childList') {
                    var frame = document.querySelector(".frame");
                    frame.addEventListener("load", function () {
                        var title = this.contentDocument.querySelector(".title");
                        if (title) {
                            var div = document.createElement("div");
                            div.className = "sub";
                            div.style.height = title.offsetHeight + "px";
                            frame.parentNode.appendChild(div);
                            div.frame = frame;
                            div.addEventListener("mousedown", mouseDown, false);
                        }
                    });
                }
            }
        };
        var observer = new MutationObserver(callback);
        observer.observe(document.body, { childList: true });
    });
</script>

</html>